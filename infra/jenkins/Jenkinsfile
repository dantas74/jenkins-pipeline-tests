pipeline {
  agent any

  options {
    buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
    disableConcurrentBuilds()
  }

  triggers {
    GenericTrigger (
      genericVariables: [
        [key: 'ref', value: '$.ref', defaultValue: 'refs/head/develop'],
        [key: 'isGoingToDeploy', value: '$.pull_request.merged', defaultValue: 'false']
      ],
      token: 'proesc-backend'
    )
  }

  stages {
    stage('Dev Environment') {
      steps {
        build job: 'proesc-backend/ci-dev',
          parameters: [booleanParam(name: 'isGoingToDeploy', value: isGoingToDeploy)],
          wait: false,
          propagate: false
      }

      when {
        expression {
          ref == 'refs/head/develop'
        }
      }
    }
  }
}